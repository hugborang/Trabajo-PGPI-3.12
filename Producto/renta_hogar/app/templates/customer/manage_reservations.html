{% extends "headers/header.html" %}

{% load static %}

{% block style_css %}
<link rel="stylesheet" href="{% static 'css/header.css' %}">
<link rel="stylesheet" href="{% static 'css/reservations.css' %}">
{% endblock %}

{% block contenido %}
<div class="reservations-container">
    <h1>Gestión de Reservas</h1>

    {% if reservations %}
        <div class="reservations-list">
            {% for reservation in reservations %}
                <div class="reservation-card">
                    <div class="reservation-photo">
                        <img src="{{ reservation.apartment.photos.first.photo.url }}" alt="Foto del Apartamento">
                    </div>
                    <div class="reservation-info">
                        <h2>{{ reservation.apartment.address }}</h2>
                        <p><strong>Capacidad:</strong> {{ reservation.apartment.guest_count }} huéspedes</p>
                        <p><strong>Fecha de inicio:</strong> {{ reservation.start_date }}</p>
                        <p><strong>Fecha de fin:</strong> {{ reservation.end_date }}</p>
                        <p><strong>Precio:</strong> ${{ reservation.total_price }}</p>
                    </div>
                    <div class="reservation-actions">
                        <form action="{% url 'delete_reservation' reservation.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash-alt"></i> Cancelar Reserva
                            </button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
    <p class="no-reservations">No tienes reservas activas.</p>
    {% endif %}
</div>



<div id="cancelationModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" id="closeModalButton">&times;</span>
        <h2>Cancelar Reserva</h2>
        <p>¿Estás seguro de que deseas cancelar la reserva?</p>
        <form method="post" id="cancelForm" action="">
            {% csrf_token %}
            <div class="modal-content">
                <h2>¿Estás seguro que deseas cancelar la reserva?</h2>
        
                    <div class="modal-buttons">
                        <button type="submit" class="btn btn-primary">Sí, cancelar reserva</button>
                        <button type="button" class="btn btn-secondary" id="closeModalButtonCancel">Cancelar</button>
                    </div>
                
                
            </div>
        </form>
    </div>
</div>


{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const cancelationModal = document.getElementById('cancelationModal');
        const closeModalButtons = document.querySelectorAll('#closeModalButton, #closeModalButtonCancel');
        const cancelForm = document.getElementById('cancelForm');

        function openModal(reservationId) {
            cancelForm.action = "{% url 'delete_reservation' 0 %}".replace('0', reservationId);
            cancelationModal.style.display = 'block';
        }

        function closeModal() {
            cancelationModal.style.display = 'none';
        }

        const openModalButtons = document.querySelectorAll('.open-modal');
        openModalButtons.forEach(button => {
            button.addEventListener('click', function() {
                const reservationId = button.getAttribute('data-id');
                openModal(reservationId);
            });
        });

        closeModalButtons.forEach(button => {
            button.addEventListener('click', closeModal);
        });

        window.addEventListener('click', function(event) {
            if (event.target === cancelationModal) {
                closeModal();
            }
        });
    });
</script>



{% endblock %}
{% endblock %}
